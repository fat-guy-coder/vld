{
  "_meta": {
    "purpose": "Optimized AI guidance for LD framework generation. Prioritizes machine readability, speed, and strict adherence to core goals. To be used by Gemini.",
    "version": "1.1.0-gemini",
    "sourceVersion": "3.2.8",
    "lastUpdated": "2025-12-29T13:28:43.089Z"
  },
  "project": {
    "name": "ld",
    "goal": "light!fast!performance!typescript!vue!react! - Beat SolidJS on key metrics.",
    "slogan": "极致性能前端框架",
    "description": "零虚拟DOM、Signal驱动、完全兼容Vue3和React Hooks的前端框架。",
    "performanceTargets": {
      "signalCreate": "<0.01ms",
      "signalGet": "<0.001ms",
      "signalSet": "<0.005ms",
      "bundleSize": "<10KB gzipped",
      "componentMount": "<0.1ms",
      "componentUpdate": "<0.05ms",
      "benchmarkGoal": "Metrics (FCP, LCP, Memory) must aim to surpass the best values from competing frameworks listed in benchmarks/frameworks-data.json."
    }
  },
  "currentState": {
    "module": "runtime-dom",
    "file": null,
    "status": "pending",
    "notes": "runtime-core模块已完成，准备开始runtime-dom模块。"
  },
  "aiDirectives": {
    "corePrinciples": [
      "MUST_READ_THIS_FILE_FIRST",
      "MUST_FOLLOW_WORKFLOW_SEQUENCE",
      "MUST_ANALYZE_EXISTING_CODE_BEFORE_GENERATION",
      "MUST_VALIDATE_EACH_STEP_WITH_TESTS",
      "MUST_UPDATE_`currentState`_AFTER_EACH_ACTION",
      "MUST_USE_CHINESE_FOR_ALL_COMMENTS_JSDOC_AND_DOCS"
    ],
    "prohibitions": [
      "NO_SKIP_VALIDATION_OR_TESTS",
      "NO_MODIFY_THIS_GUIDANCE_FILE",
      "NO_CODE_THAT_VIOLATES_`architecture`_PRINCIPLES",
      "NO_GENERATE_CODE_WITHOUT_ANALYZING_EXPORTS",
      "NO_PROCEED_IF_TESTS_FAIL"
    ],
    "codeGenerationRules": {
      "NO_UNUSED_VARIABLES": "All declared variables and imports MUST be used or removed. Predicted future use is temporarily acceptable.",
      "OPTIMAL_LOOPS": "In performance-critical hot paths, reverse for-loops (`for (let i = arr.length; i--;)`) MUST be used for unordered iteration. For ordered iteration, array length MUST be cached (`for (let i = 0, len = arr.length; i < len; i++)`). Direct use of `.length` in loop conditions is strictly forbidden in hot paths.",
      "OPTIMAL_ALGORITHMS": "All core algorithms MUST be implemented with the lowest possible time and space complexity."
    },
    "stateManagementProtocol": {
      "sourceOfTruth": "All state MUST be managed via `packages/reactivity/src/store.ts`.",
      "global": "All cross-module shared state (e.g., scheduler, caches) MUST be managed within the `globalState` object.",
      "instance": "All component-specific state (e.g., lifecycle hooks, effects) MUST be managed via `createInstanceStore` to ensure isolation. Mocking is acceptable before full component implementation.",
      "noFileScopeVars": "Do NOT use file-scoped variables for state management."
    }
  },
  "workflow": {
    "sequence": [
      "1_ANALYZE_CODEBASE",
      "2_DESIGN_CODE_STRUCTURE",
      "3_GENERATE_CODE",
      "4_UPDATE_MODULE_EXPORTS",
      "5_GENERATE_OR_UPDATE_TESTS",
      "6_EXECUTE_TESTS",
      "7_PERFORMANCE_TUNING",
      "8_BUILD_MODULE",
      "9_ANALYZE_BUNDLE",
      "10_UPDATE_CURRENT_STATE"
    ],
    "details": {
      "1_ANALYZE_CODEBASE": {
        "description": "Analyze existing code to understand context, dependencies, and available APIs. Read `packages/module.ts` and the current module's `src/index.ts` to identify all existing exports and prevent conflicts.",
        "filesToAnalyze": [
          "packages/module.ts",
          "packages/{currentState.module}/src/index.ts"
        ]
      },
      "3_GENERATE_CODE": {
        "description": "Generate the TypeScript code for the target file.",
        "rules": [
          "Adhere strictly to `codeStyle` and `templates`.",
          "Ensure all `qualityGates` are met.",
          "Performance is the highest priority."
        ]
      },
      "4_UPDATE_MODULE_EXPORTS": {
        "description": "Update the module's `index.ts` and the main `module.ts` to export new APIs.",
        "filesToUpdate": [
          "packages/{currentState.module}/src/index.ts",
          "packages/module.ts"
        ]
      },
      "5_GENERATE_OR_UPDATE_TESTS": {
        "description": "Create or update the test file corresponding to the generated code.",
        "pathTemplate": "packages/{currentState.module}/test/{filename}.test.ts",
        "requiredCoverage": [
          "normalCase",
          "boundaryCase",
          "errorCase",
          "regressionCase_afterFix"
        ]
      },
      "6_EXECUTE_TESTS": {
        "description": "Run tests for the modified file. Ensure 100% pass rate. If tests fail, you MUST fix the code and re-run tests until they all pass.",
        "command": "pnpm test:ai -- packages/{currentState.module}/test/{filename}.test.ts"
      },
      "7_PERFORMANCE_TUNING": {
        "description": "After unit tests pass, conduct performance analysis and optimization. This step can be skipped for modules that do not impact runtime performance (e.g., `cli`).",
        "steps": [
          "1_CREATE_OR_UPDATE_BENCHMARKS",
          "2_RUN_BENCHMARKS",
          "3_ANALYZE_RESULTS_AND_IDENTIFY_BOTTLENECKS",
          "4_IMPLEMENT_OPTIMIZATIONS",
          "5_VALIDATE_PERFORMANCE_GAINS"
        ],
        "qualityGate": "Performance must meet or exceed targets defined in `project.performanceTargets` and be competitive with benchmarks from `benchmarks/frameworks-data.json`."
      },
      "8_BUILD_MODULE": {
        "description": "Package the current module for distribution. This involves generating a `rollup.config.js` if one does not exist and then running the build command.",
        "tool": "Rollup/tsup",
        "rules": [
          "Do not include test files (`*.test.ts`) or benchmark files (`*.bench.ts`) in the final bundle."
        ]
      },
      "9_ANALYZE_BUNDLE": {
        "description": "Analyze the final bundle size and its dependencies using `pnpm analyze`. If the size or dependencies are not as expected, optimizations are required.",
        "command": "pnpm analyze",
        "qualityGate": "Bundle size must align with `project.performanceTargets`. Dependency graph must be clean with no unexpected additions."
      },
      "10_UPDATE_CURRENT_STATE": {
        "description": "Update the `currentState` object in this file to reflect the completion of the module and prepare for the next one."
      }
    }
  },
  "architecture": {
    "nonNegotiable": [
      "zeroVirtualDOM",
      "signalBasedReactivity",
      "fullVue3AndReactCompatibility",
      "absoluteTypeSafety",
      "extremePerformance",
      "minimalBundleSize"
    ],
    "lazyLoading": {
      "components": "All components and routes MUST support code-splitting via dynamic import().",
      "styles": "Compiler MUST output separate CSS files. Runtime MUST dynamically inject styles (via <link> or <style>) on first component mount, ensuring scoped isolation.",
      "fetchStrategy": "Runtime MUST allow custom fetch logic, defaulting to native browser import() or fetch()."
    },
    "compilation": {
      "strategy": "Hybrid: Use mature parsers, but custom code generators for performance.",
      "sfc": {
        "parser": "@vue/compiler-sfc",
        "transformer": "@ld/compiler-core (custom)",
        "generator": "@ld/compiler-core (custom)",
        "output": "Direct DOM manipulations, no VDOM."
      },
      "jsx": {
        "parser": "@babel/parser",
        "transformer": "@ld/babel-plugin-ld",
        "output": "Calls to `@ld/runtime-jsx` functions, no VDOM."
      }
    }
  },
  "modules": {
    "generationOrder": [
      "reactivity",
      "runtime-core",
      "runtime-dom",
      "runtime-jsx",
      "react",
      "vue",
      "compiler-core",
      "compiler-sfc",
      "router",
      "ld",
      "vite-plugin",
      "cli",
      "devtools",
      "babel-plugin-ld"
    ]
  },
  "codeStyle": {
    "naming": {
      "functions": "camelCase",
      "types": "PascalCase",
      "constants": "UPPER_SNAKE_CASE"
    },
    "imports": {
      "internal": "from './index'",
      "external": "from '@ld/moduleName'",
      "typeOnly": "import type { ... }"
    },
    "exports": {
      "rule": "Group exports by source file in `index.ts`. List exports individually in `module.ts`."
    }
  },
  "templates": {
    "jsdoc": {
      "function": {
        "required": [
          "@description",
          "@param",
          "@returns",
          "@example",
          "@performance",
          "@since"
        ],
        "example": "/**\n * @description ...\n * @param ...\n * @returns ...\n * @example ...\n * @performance ...\n * @since v0.1.0\n */"
      }
    }
  },
  "testing": {
    "strategy": "Intelligent Selective Testing",
    "description": "Test runners (`test.mts`, `test-ai.mts`) dynamically select which packages to test based on their status in the main `generate-code-guidance.json` file.",
    "logic": {
      "sourceOfTruth": "ai-generate-code-guidance/generate-code-guidance.json",
      "helperScript": "scripts/utils/get-active-packages.mts",
      "criteria": "Only packages with status 'completed' or 'active' are tested.",
      "fallback": "If the guidance file is unreadable, all packages (`packages/*`) are tested as a fallback."
    },
    "commands": {
      "ai_runner": "pnpm test:ai",
      "standard_runner": "pnpm test"
    }
  },
  "tooling": {
    "linter": "ESLint",
    "formatter": "Prettier",
    "bundler": "Rollup/tsup",
    "benchmark": "tinybench"
  },
  "qualityGates": {
    "performance": "All code must be JIT-friendly with minimal GC overhead.",
    "dependencies": "Dependency graph must be a DAG (no circular dependencies).",
    "types": "`any` type is strictly forbidden.",
    "testing": "Every new feature or fix must be accompanied by a passing test."
  }
}